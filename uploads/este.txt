<?php
// verTarea.php

// Conexión a la base de datos
$servidor = "localhost";
$usuario = "root";
$contraseña = "";
$baseDatos = "peis";

$conexion = new mysqli($servidor, $usuario, $contraseña, $baseDatos);

if ($conexion->connect_error) {
    die("Error de conexión: " . $conexion->connect_error);
}

// Obtener ID de la tarea y asegurarse de que es un número entero
$id_tarea = isset($_GET['id']) ? (int)$_GET['id'] : 0;

if ($id_tarea > 0) {
    $sql = "SELECT * FROM tareas WHERE id_tarea = $id_tarea";
    $resultado = $conexion->query($sql);

    if ($resultado && $resultado->num_rows > 0) {
        $tarea = $resultado->fetch_assoc();

        function obtenerNombreMateria($id_curso, $conexion) {
            $consulta = "SELECT nombre_curso FROM cursos WHERE id_curso = $id_curso";
            $resultado = $conexion->query($consulta);
            if ($resultado && $resultado->num_rows > 0) {
                $fila = $resultado->fetch_assoc();
                return $fila['nombre_curso'];
            } else {
                return "Desconocido";
            }
        }

        $nombre_materia = obtenerNombreMateria($tarea['id_curso'], $conexion);
        ?>
        <!DOCTYPE html>
        <html lang="es">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Detalles de la Tarea</title>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
            <style>
                
            </style>
        </head>
        <body>
        <div class="navbar">
            <a href="inicioAlumno.php">Inicio</a>
            <a href="gestionTareasAlumno.php">Volver</a>
        </div>
        <div class="container">
            <h1>Detalles de la Tarea</h1>
            <div class="line"></div>
            <div class="detail-item">
                <span class="detail-label">Materia:</span>
                <span><?php echo $nombre_materia; ?></span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Título:</span>
                <span><?php echo $tarea['titulo']; ?></span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Descripción:</span>
                <span><?php echo $tarea['descripcion']; ?></span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Fecha de Creación:</span>
                <span><?php echo $tarea['fecha_creacion']; ?></span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Fecha de Entrega:</span>
                <span><?php echo $tarea['fecha_limite']; ?></span>
            </div>
            <?php if (!empty($tarea['archivo_tarea'])): ?>
                <div class="detail-item">
                    <span class="detail-label">Archivo:</span>
                    <a href="<?php echo $tarea['archivo_tarea']; ?>" target="_blank"><?php echo basename($tarea['archivo_tarea']); ?></a>
                </div>
                <div class="preview">
                    <img src="<?php echo $tarea['archivo_tarea']; ?>" alt="Vista previa">
                </div>
            <?php endif; ?>

            <div class="upload-section">
                <h3>Subir tu archivo</h3>
                <form id="uploadForm" action="upload.php" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="id_tarea" value="<?php echo $id_tarea; ?>">
                    <input type="file" name="archivo" required>
                    <button type="submit">Enviar</button>
                    <button type="button" class="eliminar-btn" onclick="eliminarArchivo()">Eliminar archivo</button>
                </form>
            </div>
            <a href="gestionTareasAlumno.php" class="back-button">Regresar a Tareas Asignadas</a>
        </div>
        <div class="footer">
            © 2024 PE-ISC
        </div>
        <script>
            function eliminarArchivo() {
                const fileInput = document.querySelector('input[type="file"]');
                fileInput.value = ''; // Clear the selected file
            }
        </script>
        </body>
        </html>
        <?php
    } else {
        echo "Tarea no encontrada";
    }
} else {
    echo "ID de tarea inválido.";
}

$conexion->close();
?>
